<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Wall of Sheep | Network Monitor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="logo">
            <div class="logo-icon">üêë</div>
            <div class="logo-text">
                <h1>The Wall of Sheep</h1>
                <p>Network Traffic Monitor</p>
            </div>
        </div>
        <div class="header-actions">
            <div class="status-indicator">
                <div class="status-dot success" id="status-dot"></div>
                <span id="status-text">Live</span>
            </div>
        </div>
    </div>
</header>

<!-- Main Container -->
<main class="main-container">
    <!-- Summary Cards -->
    <div class="summary-grid">
        <div class="summary-card">
            <div class="card-header">
                <span class="card-title">Total Requests</span>
                <div class="card-icon">üåê</div>
            </div>
            <div class="card-value" id="total-requests">0</div>
            <div class="card-description">Captured network requests</div>
        </div>
        
        <div class="summary-card">
            <div class="card-header">
                <span class="card-title">HTTPS Requests</span>
                <div class="card-icon">üîí</div>
            </div>
            <div class="card-value" id="https-requests">0</div>
            <div class="card-description">HTTPS traffic count</div>
        </div>
        
        <div class="summary-card">
            <div class="card-header">
                <span class="card-title">HTTP Requests</span>
                <div class="card-icon">üîì</div>
            </div>
            <div class="card-value" id="http-requests">0</div>
            <div class="card-description">HTTP traffic count</div>
        </div>
        
        <div class="summary-card clickable" id="source-ip-card" title="View HTTP counts by source IP">
            <div class="card-header">
                <span class="card-title">Source IP (HTTP)</span>
                <div class="card-icon">üì•</div>
            </div>
            <div class="card-value"><span id="top-http-ip">-</span></div>
            <div class="card-description">Most HTTP requests ‚Ä¢ <span id="top-http-count">0</span></div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content-layout">
        <!-- Filter Icons -->
        <div class="filter-icons">
            <button class="filter-icon-btn active" data-filter="all" title="All Traffic">
                üåê
                <span class="filter-count" id="all-count">0</span>
            </button>
            <button class="filter-icon-btn" data-filter="http" title="HTTP Only">
                üîì
                <span class="filter-count" id="http-count">0</span>
            </button>
            <button class="filter-icon-btn" data-filter="https" title="HTTPS Only">
                üîí
                <span class="filter-count" id="https-count">0</span>
            </button>
            <button class="filter-icon-btn" id="clear-traffic-btn" title="Clear Current Traffic">
                üßπ
            </button>
        </div>

        <!-- Main Content Area -->
        <div class="content-grid">
            <div class="content-card">
                <div class="content-header">
                    <h2>Network Traffic</h2>
                    <div class="active-badge"><span id="now-time"></span></div>
                </div>
                <div class="table-container">
                    <table class="traffic-table">
                        <thead>
                            <tr>
                                <th id="th-source-ip" title="View HTTP counts by source IP" style="cursor:pointer;">Source IP</th>
                                <th>
                                    <div id="method-filter-control" class="method-filter">
                                        <span class="method-filter-label">METHOD</span>
                                        <span id="method-filter-chip" class="method-filter-chip" style="display:none;">ALL</span>
                                        <span class="method-filter-toggle" title="Filter by Method">‚ñæ</span>
                                    </div>
                                    <div id="method-filter-menu" class="method-filter-menu">
                                        <button class="method-filter-item" data-method="TLS">TLS</button>
                                        <button class="method-filter-item" data-method="GET">GET</button>
                                        <button class="method-filter-item" data-method="POST">POST</button>
                                        <button class="method-filter-item" data-method="PUT">PUT</button>
                                        <button class="method-filter-item" data-method="DELETE">DELETE</button>
                                        <button class="method-filter-item" data-method="ALL">ALL</button>
                                        <div class="method-filter-sep"></div>
                                        <button class="method-filter-item" data-method="OTHERS">OTHERS</button>
                                    </div>
                                </th>
                                <th>Protocol</th>
                                <th>URL</th>
                                <th>Status</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="traffic-list">
                            <!-- Traffic data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Detail Modal -->
<div id="detailModal" class="detail-modal">
    <div class="detail-modal-content">
        <div class="detail-modal-header">
            <h2>Traffic Details</h2>
            <button class="close-btn" onclick="closeDetailModal()" style="z-index:5100;">&times;</button>
        </div>
        <div class="detail-modal-body">
            <div class="detail-section">
                <h3>Basic Information</h3>
                <div class="detail-info-grid">
                    <div class="detail-info-item">
                        <strong>Source IP</strong>
                        <span id="modal-client-ip"></span>
                    </div>
                    <div class="detail-info-item">
                        <strong>Request Method</strong>
                        <span id="modal-method"></span>
                    </div>
                    <div class="detail-info-item">
                        <strong>Protocol</strong>
                        <span id="modal-protocol"></span>
                    </div>
                    <div class="detail-info-item">
                        <strong>Status Code</strong>
                        <span id="modal-status"></span>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>URL</h3>
                <div class="detail-content-box" id="modal-url"></div>
            </div>

            <div class="detail-section">
                <h3>Request Headers</h3>
                <div class="detail-content-box" id="modal-headers"></div>
            </div>

            <div class="detail-section">
                <h3>Request Body</h3>
                <div class="detail-content-box" id="modal-body"></div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='websocket.js') }}"></script>
<script src="{{ url_for('static', filename='ui.js') }}"></script>

<!-- IP Stats Modal -->
<div id="ipStatsModal" class="detail-modal">
    <div class="detail-modal-content">
        <div class="detail-modal-header">
            <h2>HTTP Connections by Source IP</h2>
            <button class="close-btn" onclick="closeIpStatsModal()">&times;</button>
        </div>
        <div class="detail-modal-body">
            <div class="detail-section">
                <div class="detail-content-box ip-stats-container">
                    <table class="traffic-table">
                        <thead>
                            <tr>
                                <th style="width:60%">Source IP</th>
                                <th style="width:40%">HTTP Count</th>
                            </tr>
                        </thead>
                        <tbody id="ip-stats-list"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- IP Requests Modal -->
<div id="ipReqsModal" class="detail-modal">
    <div class="detail-modal-content">
        <div class="detail-modal-header">
            <h2>HTTP Requests - <span id="ip-reqs-title"></span></h2>
            <button class="close-btn" onclick="closeIpReqsModal()">&times;</button>
        </div>
        <div class="detail-modal-body">
            <div class="detail-section">
                <div class="detail-content-box ip-reqs-container">
                    <table class="traffic-table">
                        <thead>
                            <tr>
                                <th style="width:12%">Method</th>
                                <th style="width:68%">URL</th>
                                <th style="width:10%">Status</th>
                                <th style="width:10%">Time</th>
                            </tr>
                        </thead>
                        <tbody id="ip-reqs-list"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>